
<script src="https://d3js.org/d3.v6.min.js"></script>
<div id="tree_plot_6b6c164274154c9db3c1490bd3d7c88c"></div>
<script>
/*
 * Copyright 2021 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

/**
 *  Plotting of decision trees generated by TF-DF.
 *
 *  A tree is a recursive structure of node objects.
 *  A node contains one or more of the following components:
 *
 *    - A value: Representing the output of the node. If the node is not a leaf,
 *      the value is only present for analysis i.e. it is not used for
 *      predictions.
 *
 *    - A condition : For non-leaf nodes, the condition (also known as split)
 *      defines a binary test to branch to the positive or negative child.
 *
 *    - An explanation: Generally a plot showing the relation between the label
 *      and the condition to give insights about the effect of the condition.
 *
 *    - Two children : For non-leaf nodes, the children nodes. The first
 *      children (i.e. "node.children[0]") is the negative children (drawn in
 *      red). The second children is the positive one (drawn in green).
 *
 */

/**
 * Plots a single decision tree into a DOM element.
 * @param {!options} options Dictionary of configurations.
 * @param {!tree} raw_tree Recursive tree structure.
 * @param {string} canvas_id Id of the output dom element.
 */
function display_tree(options, raw_tree, canvas_id) {
  console.log(options);

  // Determine the node placement.
  const tree_struct = d3.tree().nodeSize(
      [options.node_y_offset, options.node_x_offset])(d3.hierarchy(raw_tree));

  // Boundaries of the node placement.
  let x_min = Infinity;
  let x_max = -x_min;
  let y_min = Infinity;
  let y_max = -x_min;

  tree_struct.each(d => {
    if (d.x > x_max) x_max = d.x;
    if (d.x < x_min) x_min = d.x;
    if (d.y > y_max) y_max = d.y;
    if (d.y < y_min) y_min = d.y;
  });

  // Size of the plot.
  const width = y_max - y_min + options.node_x_size + options.margin * 2;
  const height = x_max - x_min + options.node_y_size + options.margin * 2 +
      options.node_y_offset - options.node_y_size;

  const plot = d3.select(canvas_id);

  // Tool tip
  options.tooltip = plot.append('div')
                        .attr('width', 100)
                        .attr('height', 100)
                        .style('padding', '4px')
                        .style('background', '#fff')
                        .style('box-shadow', '4px 4px 0px rgba(0,0,0,0.1)')
                        .style('border', '1px solid black')
                        .style('font-family', 'sans-serif')
                        .style('font-size', options.font_size)
                        .style('position', 'absolute')
                        .style('z-index', '10')
                        .attr('pointer-events', 'none')
                        .style('display', 'none');

  // Create canvas
  const svg = plot.append('svg').attr('width', width).attr('height', height);
  const graph =
      svg.style('overflow', 'visible')
          .append('g')
          .attr('font-family', 'sans-serif')
          .attr('font-size', options.font_size)
          .attr(
              'transform',
              () => `translate(${options.margin},${
                  - x_min + options.node_y_offset / 2 + options.margin})`);

  // Plot bounding box.
  if (options.show_plot_bounding_box) {
    svg.append('rect')
        .attr('width', width)
        .attr('height', height)
        .attr('fill', 'none')
        .attr('stroke-width', 1.0)
        .attr('stroke', 'black');
  }

  // Draw the edges.
  display_edges(options, graph, tree_struct);

  // Draw the nodes.
  display_nodes(options, graph, tree_struct);
}

/**
 * Draw the nodes of the tree.
 * @param {!options} options Dictionary of configurations.
 * @param {!graph} graph D3 search handle containing the graph.
 * @param {!tree_struct} tree_struct Structure of the tree (node placement,
 *     data, etc.).
 */
function display_nodes(options, graph, tree_struct) {
  const nodes = graph.append('g')
                    .selectAll('g')
                    .data(tree_struct.descendants())
                    .join('g')
                    .attr('transform', d => `translate(${d.y},${d.x})`);

  nodes.append('rect')
      .attr('x', 0.5)
      .attr('y', 0.5)
      .attr('width', options.node_x_size)
      .attr('height', options.node_y_size)
      .attr('stroke', 'lightgrey')
      .attr('stroke-width', 1)
      .attr('fill', 'white')
      .attr('y', -options.node_y_size / 2);

  // Brackets on the right of condition nodes without children.
  non_leaf_node_without_children =
      nodes.filter(node => node.data.condition != null && node.children == null)
          .append('g')
          .attr('transform', `translate(${options.node_x_size},0)`);

  non_leaf_node_without_children.append('path')
      .attr('d', 'M0,0 C 10,0 0,10 10,10')
      .attr('fill', 'none')
      .attr('stroke-width', 1.0)
      .attr('stroke', '#F00');

  non_leaf_node_without_children.append('path')
      .attr('d', 'M0,0 C 10,0 0,-10 10,-10')
      .attr('fill', 'none')
      .attr('stroke-width', 1.0)
      .attr('stroke', '#0F0');

  const node_content = nodes.append('g').attr(
      'transform',
      `translate(0,${options.node_padding - options.node_y_size / 2})`);

  node_content.append(node => create_node_element(options, node));
}

/**
 * Creates the D3 content for a single node.
 * @param {!options} options Dictionary of configurations.
 * @param {!node} node Node to draw.
 * @return {!d3} D3 content.
 */
function create_node_element(options, node) {
  // Output accumulator.
  let output = {
    // Content to draw.
    content: d3.create('svg:g'),
    // Vertical offset to the next element to draw.
    vertical_offset: 0
  };

  // Conditions.
  if (node.data.condition != null) {
    display_condition(options, node.data.condition, output);
  }

  // Values.
  if (node.data.value != null) {
    display_value(options, node.data.value, output);
  }

  // Explanations.
  if (node.data.explanation != null) {
    display_explanation(options, node.data.explanation, output);
  }

  return output.content.node();
}


/**
 * Adds a single line of text inside of a node.
 * @param {!options} options Dictionary of configurations.
 * @param {string} text Text to display.
 * @param {!output} output Output display accumulator.
 */
function display_node_text(options, text, output) {
  output.content.append('text')
      .attr('x', options.node_padding)
      .attr('y', output.vertical_offset)
      .attr('alignment-baseline', 'hanging')
      .text(text);
  output.vertical_offset += 10;
}

/**
 * Adds a single line of text inside of a node with a tooltip.
 * @param {!options} options Dictionary of configurations.
 * @param {string} text Text to display.
 * @param {string} tooltip Text in the Tooltip.
 * @param {!output} output Output display accumulator.
 */
function display_node_text_with_tooltip(options, text, tooltip, output) {
  const item = output.content.append('text')
                   .attr('x', options.node_padding)
                   .attr('alignment-baseline', 'hanging')
                   .text(text);

  add_tooltip(options, item, () => tooltip);
  output.vertical_offset += 10;
}

/**
 * Adds a tooltip to a dom element.
 * @param {!options} options Dictionary of configurations.
 * @param {!dom} target Dom element to equip with a tooltip.
 * @param {!func} get_content Generates the html content of the tooltip.
 */
function add_tooltip(options, target, get_content) {
  function show(d) {
    options.tooltip.style('display', 'block');
    options.tooltip.html(get_content());
  }

  function hide(d) {
    options.tooltip.style('display', 'none');
  }

  function move(d) {
    options.tooltip.style('display', 'block');
    options.tooltip.style('left', (d.pageX + 5) + 'px');
    options.tooltip.style('top', d.pageY + 'px');
  }

  target.on('mouseover', show);
  target.on('mouseout', hide);
  target.on('mousemove', move);
}

/**
 * Adds a condition inside of a node.
 * @param {!options} options Dictionary of configurations.
 * @param {!condition} condition Condition to display.
 * @param {!output} output Output display accumulator.
 */
function display_condition(options, condition, output) {
  threshold_format = d3.format('r');

  if (condition.type === 'IS_MISSING') {
    display_node_text(options, `${condition.attribute} is missing`, output);
    return;
  }

  if (condition.type === 'IS_TRUE') {
    display_node_text(options, `${condition.attribute} is true`, output);
    return;
  }

  if (condition.type === 'NUMERICAL_IS_HIGHER_THAN') {
    format = d3.format('r');
    display_node_text(
        options,
        `${condition.attribute} >= ${threshold_format(condition.threshold)}`,
        output);
    return;
  }

  if (condition.type === 'CATEGORICAL_IS_IN') {
    display_node_text_with_tooltip(
        options, `${condition.attribute} in [...]`,
        `${condition.attribute} in [${condition.mask}]`, output);
    return;
  }

  if (condition.type === 'CATEGORICAL_SET_CONTAINS') {
    display_node_text_with_tooltip(
        options, `${condition.attribute} intersect [...]`,
        `${condition.attribute} intersect [${condition.mask}]`, output);
    return;
  }

  if (condition.type === 'NUMERICAL_SPARSE_OBLIQUE') {
    display_node_text_with_tooltip(
        options, `Sparse oblique split...`,
        `[${condition.attributes}]*[${condition.weights}]>=${
            threshold_format(condition.threshold)}`,
        output);
    return;
  }

  display_node_text(
      options, `Non supported condition ${condition.type}`, output);
}

/**
 * Adds a value inside of a node.
 * @param {!options} options Dictionary of configurations.
 * @param {!value} value Value to display.
 * @param {!output} output Output display accumulator.
 */
function display_value(options, value, output) {
  if (value.type === 'PROBABILITY') {
    const left_margin = 0;
    const right_margin = 50;
    const plot_width = options.node_x_size - options.node_padding * 2 -
        left_margin - right_margin;

    let cusum = Array.from(d3.cumsum(value.distribution));
    cusum.unshift(0);
    const distribution_plot = output.content.append('g').attr(
        'transform', `translate(0,${output.vertical_offset + 0.5})`);

    distribution_plot.selectAll('rect')
        .data(value.distribution)
        .join('rect')
        .attr('height', 10)
        .attr(
            'x',
            (d, i) =>
                (cusum[i] * plot_width + left_margin + options.node_padding))
        .attr('width', (d, i) => d * plot_width)
        .style('fill', (d, i) => d3.schemeSet1[i]);

    const num_examples =
        output.content.append('g')
            .attr('transform', `translate(0,${output.vertical_offset})`)
            .append('text')
            .attr('x', options.node_x_size - options.node_padding)
            .attr('alignment-baseline', 'hanging')
            .attr('text-anchor', 'end')
            .text(`(${value.num_examples})`);

    const distribution_details = d3.create('ul');
    distribution_details.selectAll('li')
        .data(value.distribution)
        .join('li')
        .append('span')
        .text(
            (d, i) =>
                'class ' + i + ': ' + d3.format('.3%')(value.distribution[i]));

    add_tooltip(options, distribution_plot, () => distribution_details.html());
    add_tooltip(options, num_examples, () => 'Number of examples');

    output.vertical_offset += 10;
    return;
  }

  if (value.type === 'REGRESSION') {
    display_node_text(
        options,
        'value: ' + d3.format('r')(value.value) + ` (` +
            d3.format('.6')(value.num_examples) + `)`,
        output);
    return;
  }

  display_node_text(options, `Non supported value ${value.type}`, output);
}

/**
 * Adds an explanation inside of a node.
 * @param {!options} options Dictionary of configurations.
 * @param {!explanation} explanation Explanation to display.
 * @param {!output} output Output display accumulator.
 */
function display_explanation(options, explanation, output) {
  // Margin before the explanation.
  output.vertical_offset += 10;

  display_node_text(
      options, `Non supported explanation ${explanation.type}`, output);
}


/**
 * Draw the edges of the tree.
 * @param {!options} options Dictionary of configurations.
 * @param {!graph} graph D3 search handle containing the graph.
 * @param {!tree_struct} tree_struct Structure of the tree (node placement,
 *     data, etc.).
 */
function display_edges(options, graph, tree_struct) {
  // Draw an edge between a parent and a child node with a bezier.
  function draw_single_edge(d) {
    return 'M' + (d.source.y + options.node_x_size) + ',' + d.source.x + ' C' +
        (d.source.y + options.node_x_size + options.edge_rounding) + ',' +
        d.source.x + ' ' + (d.target.y - options.edge_rounding) + ',' +
        d.target.x + ' ' + d.target.y + ',' + d.target.x;
  }

  graph.append('g')
      .attr('fill', 'none')
      .attr('stroke-width', 1.2)
      .selectAll('path')
      .data(tree_struct.links())
      .join('path')
      .attr('d', draw_single_edge)
      .attr(
          'stroke', d => (d.target === d.source.children[0]) ? '#0F0' : '#F00');
}

display_tree({"margin": 10, "node_x_size": 160, "node_y_size": 28, "node_x_offset": 180, "node_y_offset": 33, "font_size": 10, "edge_rounding": 20, "node_padding": 2, "show_plot_bounding_box": false}, {"value": {"type": "PROBABILITY", "distribution": [0.6632943408156813, 0.33670565918431866], "num_examples": 3163.0}, "condition": {"type": "CATEGORICAL_IS_IN", "attribute": "EmploymentDuration", "mask": ["4_to_7", "greater_7"]}, "children": [{"value": {"type": "PROBABILITY", "distribution": [0.4475862068965517, 0.5524137931034483], "num_examples": 1450.0}, "condition": {"type": "CATEGORICAL_IS_IN", "attribute": "CheckingStatus", "mask": ["no_checking", "greater_200"]}, "children": [{"value": {"type": "PROBABILITY", "distribution": [0.3216132368148914, 0.6783867631851086], "num_examples": 967.0}, "condition": {"type": "CATEGORICAL_IS_IN", "attribute": "Housing", "mask": ["free"]}, "children": [{"value": {"type": "PROBABILITY", "distribution": [0.18232044198895028, 0.8176795580110497], "num_examples": 362.0}, "condition": {"type": "NUMERICAL_IS_HIGHER_THAN", "attribute": "CurrentResidenceDuration", "threshold": 3.5}, "children": [{"value": {"type": "PROBABILITY", "distribution": [0.12698412698412698, 0.873015873015873], "num_examples": 252.0}, "condition": {"type": "NUMERICAL_IS_HIGHER_THAN", "attribute": "Age", "threshold": 43.5}, "children": [{"value": {"type": "PROBABILITY", "distribution": [0.08133971291866028, 0.9186602870813397], "num_examples": 209.0}}, {"value": {"type": "PROBABILITY", "distribution": [0.3488372093023256, 0.6511627906976745], "num_examples": 43.0}, "condition": {"type": "CATEGORICAL_IS_IN", "attribute": "Sex", "mask": ["female"]}, "children": [{"value": {"type": "PROBABILITY", "distribution": [0.0, 1.0], "num_examples": 12.0}}, {"value": {"type": "PROBABILITY", "distribution": [0.4838709677419355, 0.5161290322580645], "num_examples": 31.0}, "condition": {"type": "CATEGORICAL_IS_IN", "attribute": "OthersOnLoan", "mask": ["co-applicant"]}, "children": [{"value": {"type": "PROBABILITY", "distribution": [0.13333333333333333, 0.8666666666666667], "num_examples": 15.0}}, {"value": {"type": "PROBABILITY", "distribution": [0.8125, 0.1875], "num_examples": 16.0}}]}]}]}, {"value": {"type": "PROBABILITY", "distribution": [0.3090909090909091, 0.6909090909090909], "num_examples": 110.0}}]}, {"value": {"type": "PROBABILITY", "distribution": [0.4049586776859504, 0.5950413223140496], "num_examples": 605.0}, "condition": {"type": "CATEGORICAL_IS_IN", "attribute": "Sex", "mask": ["female"]}, "children": [{"value": {"type": "PROBABILITY", "distribution": [0.22395833333333334, 0.7760416666666666], "num_examples": 192.0}}, {"value": {"type": "PROBABILITY", "distribution": [0.4891041162227603, 0.5108958837772397], "num_examples": 413.0}, "condition": {"type": "CATEGORICAL_IS_IN", "attribute": "CreditHistory", "mask": ["outstanding_credit"]}, "children": [{"value": {"type": "PROBABILITY", "distribution": [0.32867132867132864, 0.6713286713286714], "num_examples": 143.0}, "condition": {"type": "NUMERICAL_IS_HIGHER_THAN", "attribute": "Age", "threshold": 54.5}, "children": [{"value": {"type": "PROBABILITY", "distribution": [0.0, 1.0], "num_examples": 19.0}}, {"value": {"type": "PROBABILITY", "distribution": [0.3790322580645161, 0.6209677419354839], "num_examples": 124.0}, "condition": {"type": "CATEGORICAL_IS_IN", "attribute": "OthersOnLoan", "mask": ["co-applicant", "guarantor"]}, "children": [{"value": {"type": "PROBABILITY", "distribution": [0.1956521739130435, 0.8043478260869565], "num_examples": 46.0}}, {"value": {"type": "PROBABILITY", "distribution": [0.48717948717948717, 0.5128205128205128], "num_examples": 78.0}, "condition": {"type": "CATEGORICAL_IS_IN", "attribute": "OwnsProperty", "mask": ["unknown"]}, "children": [{"value": {"type": "PROBABILITY", "distribution": [0.21052631578947367, 0.7894736842105263], "num_examples": 19.0}, "condition": {"type": "CATEGORICAL_IS_IN", "attribute": "LoanPurpose", "mask": ["car_used", "radio_tv", "vacation", "retraining", "business", "other"]}, "children": [{"value": {"type": "PROBABILITY", "distribution": [0.0, 1.0], "num_examples": 8.0}}, {"value": {"type": "PROBABILITY", "distribution": [0.36363636363636365, 0.6363636363636364], "num_examples": 11.0}, "condition": {"type": "NUMERICAL_IS_HIGHER_THAN", "attribute": "LoanDuration", "threshold": 27.0}, "children": [{"value": {"type": "PROBABILITY", "distribution": [0.5, 0.5], "num_examples": 6.0}}, {"value": {"type": "PROBABILITY", "distribution": [0.2, 0.8], "num_examples": 5.0}}]}]}, {"value": {"type": "PROBABILITY", "distribution": [0.576271186440678, 0.423728813559322], "num_examples": 59.0}, "condition": {"type": "NUMERICAL_IS_HIGHER_THAN", "attribute": "LoanAmount", "threshold": 2191.5}, "children": [{"value": {"type": "PROBABILITY", "distribution": [0.6296296296296297, 0.37037037037037035], "num_examples": 54.0}, "condition": {"type": "NUMERICAL_IS_HIGHER_THAN", "attribute": "LoanAmount", "threshold": 6404.5}, "children": [{"value": {"type": "PROBABILITY", "distribution": [0.875, 0.125], "num_examples": 8.0}}, {"value": {"type": "PROBABILITY", "distribution": [0.5869565217391305, 0.41304347826086957], "num_examples": 46.0}, "condition": {"type": "NUMERICAL_IS_HIGHER_THAN", "attribute": "CurrentResidenceDuration", "threshold": 3.5}, "children": [{"value": {"type": "PROBABILITY", "distribution": [0.4166666666666667, 0.5833333333333334], "num_examples": 24.0}}, {"value": {"type": "PROBABILITY", "distribution": [0.7727272727272727, 0.22727272727272727], "num_examples": 22.0}}]}]}, {"value": {"type": "PROBABILITY", "distribution": [0.0, 1.0], "num_examples": 5.0}}]}]}]}]}, {"value": {"type": "PROBABILITY", "distribution": [0.5740740740740741, 0.42592592592592593], "num_examples": 270.0}, "condition": {"type": "CATEGORICAL_IS_IN", "attribute": "OthersOnLoan", "mask": ["co-applicant"]}, "children": [{"value": {"type": "PROBABILITY", "distribution": [0.2653061224489796, 0.7346938775510204], "num_examples": 49.0}}, {"value": {"type": "PROBABILITY", "distribution": [0.6425339366515838, 0.3574660633484163], "num_examples": 221.0}}]}]}]}]}, {"value": {"type": "PROBABILITY", "distribution": [0.6997929606625258, 0.3002070393374741], "num_examples": 483.0}, "condition": {"type": "NUMERICAL_IS_HIGHER_THAN", "attribute": "Age", "threshold": 28.5}, "children": [{"value": {"type": "PROBABILITY", "distribution": [0.6376021798365122, 0.36239782016348776], "num_examples": 367.0}, "condition": {"type": "NUMERICAL_IS_HIGHER_THAN", "attribute": "LoanDuration", "threshold": 38.5}, "children": [{"value": {"type": "PROBABILITY", "distribution": [0.15384615384615385, 0.8461538461538461], "num_examples": 13.0}}, {"value": {"type": "PROBABILITY", "distribution": [0.655367231638418, 0.3446327683615819], "num_examples": 354.0}, "condition": {"type": "NUMERICAL_IS_HIGHER_THAN", "attribute": "CurrentResidenceDuration", "threshold": 2.5}, "children": [{"value": {"type": "PROBABILITY", "distribution": [0.5561224489795918, 0.44387755102040816], "num_examples": 196.0}, "condition": {"type": "CATEGORICAL_IS_IN", "attribute": "CheckingStatus", "mask": ["0_to_200"]}, "children": [{"value": {"type": "PROBABILITY", "distribution": [0.5070422535211268, 0.49295774647887325], "num_examples": 142.0}, "condition": {"type": "NUMERICAL_IS_HIGHER_THAN", "attribute": "Age", "threshold": 46.0}, "children": [{"value": {"type": "PROBABILITY", "distribution": [0.3157894736842105, 0.6842105263157895], "num_examples": 19.0}, "condition": {"type": "CATEGORICAL_IS_IN", "attribute": "Sex", "mask": ["female"]}, "children": [{"value": {"type": "PROBABILITY", "distribution": [0.18181818181818182, 0.8181818181818182], "num_examples": 11.0}}, {"value": {"type": "PROBABILITY", "distribution": [0.5, 0.5], "num_examples": 8.0}}]}, {"value": {"type": "PROBABILITY", "distribution": [0.5365853658536586, 0.4634146341463415], "num_examples": 123.0}}]}, {"value": {"type": "PROBABILITY", "distribution": [0.6851851851851852, 0.3148148148148148], "num_examples": 54.0}}]}, {"value": {"type": "PROBABILITY", "distribution": [0.7784810126582279, 0.22151898734177214], "num_examples": 158.0}}]}]}, {"value": {"type": "PROBABILITY", "distribution": [0.896551724137931, 0.10344827586206896], "num_examples": 116.0}}]}]}, {"value": {"type": "PROBABILITY", "distribution": [0.8458844133099825, 0.15411558669001751], "num_examples": 1713.0}, "condition": {"type": "NUMERICAL_IS_HIGHER_THAN", "attribute": "LoanDuration", "threshold": 12.5}, "children": [{"value": {"type": "PROBABILITY", "distribution": [0.7760314341846758, 0.22396856581532418], "num_examples": 1018.0}, "condition": {"type": "CATEGORICAL_IS_IN", "attribute": "EmploymentDuration", "mask": ["1_to_4"]}, "children": [{"value": {"type": "PROBABILITY", "distribution": [0.7201210287443268, 0.27987897125567324], "num_examples": 661.0}, "condition": {"type": "CATEGORICAL_IS_IN", "attribute": "CheckingStatus", "mask": ["no_checking", "greater_200"]}, "children": [{"value": {"type": "PROBABILITY", "distribution": [0.6480263157894737, 0.3519736842105263], "num_examples": 304.0}, "condition": {"type": "NUMERICAL_IS_HIGHER_THAN", "attribute": "LoanAmount", "threshold": 1258.5}, "children": [{"value": {"type": "PROBABILITY", "distribution": [0.6385135135135135, 0.3614864864864865], "num_examples": 296.0}, "condition": {"type": "CATEGORICAL_IS_IN", "attribute": "LoanPurpose", "mask": ["car_new", "car_used", "vacation", "other"]}, "children": [{"value": {"type": "PROBABILITY", "distribution": [0.5256410256410257, 0.47435897435897434], "num_examples": 78.0}}, {"value": {"type": "PROBABILITY", "distribution": [0.6788990825688074, 0.3211009174311927], "num_examples": 218.0}, "condition": {"type": "NUMERICAL_IS_HIGHER_THAN", "attribute": "LoanDuration", "threshold": 29.5}, "children": [{"value": {"type": "PROBABILITY", "distribution": [0.5844155844155844, 0.4155844155844156], "num_examples": 77.0}, "condition": {"type": "CATEGORICAL_IS_IN", "attribute": "Job", "mask": ["skilled"]}, "children": [{"value": {"type": "PROBABILITY", "distribution": [0.52, 0.48], "num_examples": 50.0}, "condition": {"type": "CATEGORICAL_IS_IN", "attribute": "Housing", "mask": ["rent", "free"]}, "children": [{"value": {"type": "PROBABILITY", "distribution": [0.2222222222222222, 0.7777777777777778], "num_examples": 9.0}}, {"value": {"type": "PROBABILITY", "distribution": [0.5853658536585366, 0.4146341463414634], "num_examples": 41.0}, "condition": {"type": "NUMERICAL_IS_HIGHER_THAN", "attribute": "LoanAmount", "threshold": 5667.5}, "children": [{"value": {"type": "PROBABILITY", "distribution": [0.4166666666666667, 0.5833333333333334], "num_examples": 12.0}}, {"value": {"type": "PROBABILITY", "distribution": [0.6551724137931034, 0.3448275862068966], "num_examples": 29.0}}]}]}, {"value": {"type": "PROBABILITY", "distribution": [0.7037037037037037, 0.2962962962962963], "num_examples": 27.0}, "condition": {"type": "CATEGORICAL_IS_IN", "attribute": "LoanPurpose", "mask": ["radio_tv", "appliances", "repairs", "business"]}, "children": [{"value": {"type": "PROBABILITY", "distribution": [0.6190476190476191, 0.38095238095238093], "num_examples": 21.0}, "condition": {"type": "CATEGORICAL_IS_IN", "attribute": "CreditHistory", "mask": ["credits_paid_to_date", "outstanding_credit"]}, "children": [{"value": {"type": "PROBABILITY", "distribution": [0.375, 0.625], "num_examples": 8.0}}, {"value": {"type": "PROBABILITY", "distribution": [0.7692307692307693, 0.23076923076923078], "num_examples": 13.0}}]}, {"value": {"type": "PROBABILITY", "distribution": [1.0, 0.0], "num_examples": 6.0}}]}]}, {"value": {"type": "PROBABILITY", "distribution": [0.7304964539007093, 0.2695035460992908], "num_examples": 141.0}, "condition": {"type": "CATEGORICAL_IS_IN", "attribute": "ExistingSavings", "mask": ["less_100", "500_to_1000", "greater_1000", "unknown"]}, "children": [{"value": {"type": "PROBABILITY", "distribution": [0.6493506493506493, 0.35064935064935066], "num_examples": 77.0}, "condition": {"type": "NUMERICAL_IS_HIGHER_THAN", "attribute": "Age", "threshold": 48.5}, "children": [{"value": {"type": "PROBABILITY", "distribution": [0.4, 0.6], "num_examples": 10.0}}, {"value": {"type": "PROBABILITY", "distribution": [0.6865671641791045, 0.31343283582089554], "num_examples": 67.0}, "condition": {"type": "NUMERICAL_IS_HIGHER_THAN", "attribute": "LoanAmount", "threshold": 2166.5}, "children": [{"value": {"type": "PROBABILITY", "distribution": [0.7333333333333333, 0.26666666666666666], "num_examples": 60.0}, "condition": {"type": "CATEGORICAL_IS_IN", "attribute": "Sex", "mask": ["male"]}, "children": [{"value": {"type": "PROBABILITY", "distribution": [0.6428571428571429, 0.35714285714285715], "num_examples": 42.0}, "condition": {"type": "CATEGORICAL_IS_IN", "attribute": "ExistingSavings", "mask": ["less_100", "500_to_1000", "unknown"]}, "children": [{"value": {"type": "PROBABILITY", "distribution": [0.5483870967741935, 0.45161290322580644], "num_examples": 31.0}, "condition": {"type": "CATEGORICAL_IS_IN", "attribute": "OwnsProperty", "mask": ["car_other", "unknown"]}}, {"value": {"type": "PROBABILITY", "distribution": [0.9090909090909091, 0.09090909090909091], "num_examples": 11.0}}]}, {"value": {"type": "PROBABILITY", "distribution": [0.9444444444444444, 0.05555555555555555], "num_examples": 18.0}}]}, {"value": {"type": "PROBABILITY", "distribution": [0.2857142857142857, 0.7142857142857143], "num_examples": 7.0}}]}]}, {"value": {"type": "PROBABILITY", "distribution": [0.828125, 0.171875], "num_examples": 64.0}}]}]}]}, {"value": {"type": "PROBABILITY", "distribution": [1.0, 0.0], "num_examples": 8.0}}]}, {"value": {"type": "PROBABILITY", "distribution": [0.7815126050420168, 0.2184873949579832], "num_examples": 357.0}, "condition": {"type": "NUMERICAL_IS_HIGHER_THAN", "attribute": "ExistingCreditsCount", "threshold": 1.5}, "children": [{"value": {"type": "PROBABILITY", "distribution": [0.6946564885496184, 0.3053435114503817], "num_examples": 131.0}, "condition": {"type": "CATEGORICAL_IS_IN", "attribute": "LoanPurpose", "mask": ["car_new", "furniture", "car_used", "appliances", "repairs", "vacation", "retraining"]}, "children": [{"value": {"type": "PROBABILITY", "distribution": [0.6344086021505376, 0.3655913978494624], "num_examples": 93.0}, "condition": {"type": "CATEGORICAL_IS_IN", "attribute": "CreditHistory", "mask": ["prior_payments_delayed", "outstanding_credit"]}, "children": [{"value": {"type": "PROBABILITY", "distribution": [0.48717948717948717, 0.5128205128205128], "num_examples": 39.0}}, {"value": {"type": "PROBABILITY", "distribution": [0.7407407407407407, 0.25925925925925924], "num_examples": 54.0}}]}, {"value": {"type": "PROBABILITY", "distribution": [0.8421052631578947, 0.15789473684210525], "num_examples": 38.0}, "condition": {"type": "CATEGORICAL_IS_IN", "attribute": "CreditHistory", "mask": ["prior_payments_delayed"]}, "children": [{"value": {"type": "PROBABILITY", "distribution": [0.7, 0.3], "num_examples": 20.0}, "condition": {"type": "NUMERICAL_IS_HIGHER_THAN", "attribute": "Age", "threshold": 32.5}, "children": [{"value": {"type": "PROBABILITY", "distribution": [0.5, 0.5], "num_examples": 12.0}, "condition": {"type": "CATEGORICAL_IS_IN", "attribute": "ExistingSavings", "mask": ["less_100", "greater_1000"]}, "children": [{"value": {"type": "PROBABILITY", "distribution": [0.16666666666666666, 0.8333333333333334], "num_examples": 6.0}}, {"value": {"type": "PROBABILITY", "distribution": [0.8333333333333334, 0.16666666666666666], "num_examples": 6.0}}]}, {"value": {"type": "PROBABILITY", "distribution": [1.0, 0.0], "num_examples": 8.0}}]}, {"value": {"type": "PROBABILITY", "distribution": [1.0, 0.0], "num_examples": 18.0}}]}]}, {"value": {"type": "PROBABILITY", "distribution": [0.831858407079646, 0.168141592920354], "num_examples": 226.0}}]}]}, {"value": {"type": "PROBABILITY", "distribution": [0.8795518207282913, 0.12044817927170869], "num_examples": 357.0}}]}, {"value": {"type": "PROBABILITY", "distribution": [0.9482014388489208, 0.051798561151079135], "num_examples": 695.0}, "condition": {"type": "NUMERICAL_IS_HIGHER_THAN", "attribute": "ExistingCreditsCount", "threshold": 1.5}, "children": [{"value": {"type": "PROBABILITY", "distribution": [0.7948717948717948, 0.20512820512820512], "num_examples": 78.0}, "condition": {"type": "NUMERICAL_IS_HIGHER_THAN", "attribute": "LoanAmount", "threshold": 883.5}, "children": [{"value": {"type": "PROBABILITY", "distribution": [0.7368421052631579, 0.2631578947368421], "num_examples": 57.0}, "condition": {"type": "NUMERICAL_IS_HIGHER_THAN", "attribute": "CurrentResidenceDuration", "threshold": 2.5}, "children": [{"value": {"type": "PROBABILITY", "distribution": [0.625, 0.375], "num_examples": 32.0}, "condition": {"type": "CATEGORICAL_IS_IN", "attribute": "LoanPurpose", "mask": ["furniture", "car_used", "repairs", "vacation", "retraining", "education"]}, "children": [{"value": {"type": "PROBABILITY", "distribution": [0.47619047619047616, 0.5238095238095238], "num_examples": 21.0}}, {"value": {"type": "PROBABILITY", "distribution": [0.9090909090909091, 0.09090909090909091], "num_examples": 11.0}}]}, {"value": {"type": "PROBABILITY", "distribution": [0.88, 0.12], "num_examples": 25.0}}]}, {"value": {"type": "PROBABILITY", "distribution": [0.9523809523809523, 0.047619047619047616], "num_examples": 21.0}}]}, {"value": {"type": "PROBABILITY", "distribution": [0.9675850891410048, 0.03241491085899514], "num_examples": 617.0}, "condition": {"type": "CATEGORICAL_IS_IN", "attribute": "Telephone", "mask": ["yes"]}, "children": [{"value": {"type": "PROBABILITY", "distribution": [0.8813559322033898, 0.11864406779661017], "num_examples": 59.0}}, {"value": {"type": "PROBABILITY", "distribution": [0.9767025089605734, 0.023297491039426525], "num_examples": 558.0}, "condition": {"type": "CATEGORICAL_IS_IN", "attribute": "CreditHistory", "mask": ["prior_payments_delayed", "outstanding_credit"]}, "children": [{"value": {"type": "PROBABILITY", "distribution": [0.8888888888888888, 0.1111111111111111], "num_examples": 63.0}, "condition": {"type": "CATEGORICAL_IS_IN", "attribute": "LoanPurpose", "mask": ["car_new", "radio_tv", "appliances"]}, "children": [{"value": {"type": "PROBABILITY", "distribution": [0.6956521739130435, 0.30434782608695654], "num_examples": 23.0}, "condition": {"type": "CATEGORICAL_IS_IN", "attribute": "Job", "mask": ["unskilled", "management_self-employed"]}, "children": [{"value": {"type": "PROBABILITY", "distribution": [0.2, 0.8], "num_examples": 5.0}}, {"value": {"type": "PROBABILITY", "distribution": [0.8333333333333334, 0.16666666666666666], "num_examples": 18.0}, "condition": {"type": "CATEGORICAL_IS_IN", "attribute": "EmploymentDuration", "mask": ["1_to_4"]}, "children": [{"value": {"type": "PROBABILITY", "distribution": [0.75, 0.25], "num_examples": 12.0}, "condition": {"type": "CATEGORICAL_IS_IN", "attribute": "OwnsProperty", "mask": ["car_other", "unknown"]}, "children": [{"value": {"type": "PROBABILITY", "distribution": [0.4, 0.6], "num_examples": 5.0}}, {"value": {"type": "PROBABILITY", "distribution": [1.0, 0.0], "num_examples": 7.0}}]}, {"value": {"type": "PROBABILITY", "distribution": [1.0, 0.0], "num_examples": 6.0}}]}]}, {"value": {"type": "PROBABILITY", "distribution": [1.0, 0.0], "num_examples": 40.0}}]}, {"value": {"type": "PROBABILITY", "distribution": [0.9878787878787879, 0.012121212121212121], "num_examples": 495.0}}]}]}]}]}]}, "#tree_plot_6b6c164274154c9db3c1490bd3d7c88c")
</script>
